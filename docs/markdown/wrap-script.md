# wrap-html.sh - HTML Wrapper Script

A pure bash script that wraps SOMA-generated HTML content in a complete, styled HTML document.

## What It Does

Takes raw HTML content generated by SOMA's `HtmlEmitter` and creates a complete, styled HTML document with:
- Proper DOCTYPE and HTML structure
- Linked `soma-document.css` stylesheet
- Automatic title extraction from first `<h1>` tag
- Responsive meta tags
- Clean, valid HTML5 output

## Usage

```bash
./wrap-html.sh input.html [output.html]
```

### Arguments

- `input.html` - File containing SOMA-generated HTML content (required)
- `output.html` - Output file path (optional)

If no output file is specified, defaults to `input-styled.html`

## Examples

### Basic Usage

```bash
# Generate HTML with SOMA
soma my-document.soma    # Creates my-document.html

# Wrap it with styling
./wrap-html.sh my-document.html

# Opens: my-document-styled.html
```

### Custom Output Path

```bash
./wrap-html.sh raw-content.html docs/styled-document.html
```

### Complete Workflow

```bash
# 1. Create a SOMA document
cat > example.soma <<'EOF'
(python) >use
(markdown) >use
>md.start
md.htmlEmitter >md.emitter

(My Amazing Document) >md.h1

(This is the introduction.) >md.p

(Features)
>md.h2

(Feature one)
(Feature two)
(Feature three)
>md.ul

(output.html) >md.render
EOF

# 2. Generate HTML
soma example.soma

# 3. Wrap with styling
./wrap-html.sh output.html

# 4. Open in browser
open output-styled.html  # macOS
xdg-open output-styled.html  # Linux
```

## Features

### Automatic Title Extraction

The script extracts the document title from the first `<h1>` tag:

```html
<h1>My Document</h1>  →  <title>My Document</title>
```

If no `<h1>` is found, uses the input filename.

### Intelligent CSS Path Resolution

The script automatically determines the correct relative path to `soma-document.css` based on where the output file will be located:

```bash
# Same directory as CSS
./wrap-html.sh doc.html                  # → href="soma-document.css"

# Different directory
./wrap-html.sh doc.html ../docs/doc.html # → href="../examples/markdown/soma-document.css"
```

### File Size Information

After creating the styled document, the script shows:
- Input file size
- Output file size
- File path for browser

```
✓ Created styled HTML: output-styled.html

File sizes:
  Input:  645 bytes
  Output: 958 bytes

Open in browser:
  file:///path/to/output-styled.html
```

## Requirements

- Bash 4.0 or later
- `realpath` command (standard on most Linux systems)
- `soma-document.css` in the same directory as the script

## Error Handling

The script handles common errors:

- **Missing input file**: Shows error and exits
- **Missing CSS file**: Shows error and exits
- **No arguments**: Shows usage information
- **Invalid paths**: Shows descriptive error messages

## Pure Bash

This script uses only bash built-ins and standard POSIX utilities:
- No Python, Ruby, or other interpreters required
- No external libraries needed
- Portable across Linux/macOS/Unix systems

## Integration with SOMA

### Typical Workflow

1. Write SOMA document with `md.htmlEmitter >md.emitter`
2. Render with `>md.render`
3. Wrap with `./wrap-html.sh`
4. Open in browser or deploy to web server

### Automation

Create a simple wrapper script:

```bash
#!/bin/bash
# build-docs.sh - Generate and style HTML docs

soma "$1"                    # Generate HTML
./wrap-html.sh "${1%.soma}.html"  # Wrap with styling
```

Usage:
```bash
./build-docs.sh my-document.soma
```

## Output Structure

The script generates valid HTML5:

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="SOMA Markdown Extension">
  <title>Extracted Title</title>
  <link rel="stylesheet" href="soma-document.css">
</head>
<body>

[Your SOMA-generated content here]

</body>
</html>
```

## Troubleshooting

### CSS Not Found

If you see "CSS file not found", ensure `soma-document.css` is in the same directory as `wrap-html.sh`.

### Permission Denied

Make the script executable:
```bash
chmod +x wrap-html.sh
```

### Relative Paths Not Working

If CSS paths are incorrect, try using absolute paths or ensure both the CSS and output are in expected locations.

## See Also

- `soma-document.css` - The stylesheet used
- `template.html` - Manual HTML template
- `CSS-README.md` - CSS documentation
- `html_example.soma` - Complete SOMA example
